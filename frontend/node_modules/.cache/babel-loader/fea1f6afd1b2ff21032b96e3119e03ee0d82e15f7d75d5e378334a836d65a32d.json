{"ast":null,"code":"var _jsxFileName = \"/workspaces/TrustFlow-App/frontend/src/contexts/AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\nimport { supabase, signOut as supabaseSignOut } from '@/lib/supabase';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext({});\nexport const useAuth = () => {\n  _s();\n  return useContext(AuthContext);\n};\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [user, setUser] = useState(null);\n  const [profile, setProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [initialized, setInitialized] = useState(false);\n  const fetchProfile = useCallback(async userId => {\n    if (!userId) return;\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('profiles').select('*').eq('id', userId).single();\n      if (error && error.code !== 'PGRST116') {\n        console.error('Error fetching profile:', error);\n      }\n      setProfile(data || null);\n    } catch (error) {\n      console.error('Error fetching profile:', error);\n    }\n  }, []);\n  useEffect(() => {\n    let mounted = true;\n\n    // Get initial session - use getSession which is faster\n    const initAuth = async () => {\n      try {\n        const {\n          data: {\n            session\n          },\n          error\n        } = await supabase.auth.getSession();\n        if (error) {\n          console.error('Session error:', error);\n        }\n        if (mounted) {\n          const currentUser = (session === null || session === void 0 ? void 0 : session.user) || null;\n          setUser(currentUser);\n          setLoading(false);\n          setInitialized(true);\n\n          // Fetch profile in background (non-blocking)\n          if (currentUser) {\n            fetchProfile(currentUser.id);\n          }\n        }\n      } catch (error) {\n        console.error('Error getting session:', error);\n        if (mounted) {\n          setLoading(false);\n          setInitialized(true);\n        }\n      }\n    };\n    initAuth();\n\n    // Listen for auth changes\n    const {\n      data: {\n        subscription\n      }\n    } = supabase.auth.onAuthStateChange(async (event, session) => {\n      if (!mounted) return;\n      const currentUser = (session === null || session === void 0 ? void 0 : session.user) || null;\n      setUser(currentUser);\n      if (currentUser) {\n        fetchProfile(currentUser.id);\n      } else {\n        setProfile(null);\n      }\n      if (!initialized) {\n        setLoading(false);\n        setInitialized(true);\n      }\n    });\n    return () => {\n      mounted = false;\n      subscription.unsubscribe();\n    };\n  }, [fetchProfile, initialized]);\n  const signOut = useCallback(async () => {\n    await supabaseSignOut();\n    setUser(null);\n    setProfile(null);\n  }, []);\n  const value = {\n    user,\n    profile,\n    loading,\n    signOut,\n    refreshProfile: useCallback(() => user && fetchProfile(user.id), [user, fetchProfile])\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 108,\n    columnNumber: 5\n  }, this);\n};\n_s2(AuthProvider, \"NH8R2MPDeAJ9LLsjGuD+8VzT73M=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useCallback","supabase","signOut","supabaseSignOut","jsxDEV","_jsxDEV","AuthContext","useAuth","_s","AuthProvider","children","_s2","user","setUser","profile","setProfile","loading","setLoading","initialized","setInitialized","fetchProfile","userId","data","error","from","select","eq","single","code","console","mounted","initAuth","session","auth","getSession","currentUser","id","subscription","onAuthStateChange","event","unsubscribe","value","refreshProfile","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/workspaces/TrustFlow-App/frontend/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\nimport { supabase, signOut as supabaseSignOut } from '@/lib/supabase';\n\nconst AuthContext = createContext({});\n\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [profile, setProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [initialized, setInitialized] = useState(false);\n\n  const fetchProfile = useCallback(async (userId) => {\n    if (!userId) return;\n    try {\n      const { data, error } = await supabase\n        .from('profiles')\n        .select('*')\n        .eq('id', userId)\n        .single();\n\n      if (error && error.code !== 'PGRST116') {\n        console.error('Error fetching profile:', error);\n      }\n      setProfile(data || null);\n    } catch (error) {\n      console.error('Error fetching profile:', error);\n    }\n  }, []);\n\n  useEffect(() => {\n    let mounted = true;\n\n    // Get initial session - use getSession which is faster\n    const initAuth = async () => {\n      try {\n        const { data: { session }, error } = await supabase.auth.getSession();\n        \n        if (error) {\n          console.error('Session error:', error);\n        }\n        \n        if (mounted) {\n          const currentUser = session?.user || null;\n          setUser(currentUser);\n          setLoading(false);\n          setInitialized(true);\n          \n          // Fetch profile in background (non-blocking)\n          if (currentUser) {\n            fetchProfile(currentUser.id);\n          }\n        }\n      } catch (error) {\n        console.error('Error getting session:', error);\n        if (mounted) {\n          setLoading(false);\n          setInitialized(true);\n        }\n      }\n    };\n\n    initAuth();\n\n    // Listen for auth changes\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\n      async (event, session) => {\n        if (!mounted) return;\n        \n        const currentUser = session?.user || null;\n        setUser(currentUser);\n        \n        if (currentUser) {\n          fetchProfile(currentUser.id);\n        } else {\n          setProfile(null);\n        }\n        \n        if (!initialized) {\n          setLoading(false);\n          setInitialized(true);\n        }\n      }\n    );\n\n    return () => {\n      mounted = false;\n      subscription.unsubscribe();\n    };\n  }, [fetchProfile, initialized]);\n\n  const signOut = useCallback(async () => {\n    await supabaseSignOut();\n    setUser(null);\n    setProfile(null);\n  }, []);\n\n  const value = {\n    user,\n    profile,\n    loading,\n    signOut,\n    refreshProfile: useCallback(() => user && fetchProfile(user.id), [user, fetchProfile]),\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}